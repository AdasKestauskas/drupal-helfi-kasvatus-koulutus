{#
/**
 * @file
 * Theme for unit entity.
 */
#}

{% if not block_name %}
  {% set block_name = 'main_navigation_level_2' %}
{% endif %}

{% if drupal_entity('block', block_name, check_access=false)|render|striptags|trim is not empty %}
  {% set in_menu =  TRUE %}
{% endif %}

{% if view_mode == 'high_school_card' or view_mode == 'vocational_school_card' %}

  {% if view_mode == 'high_school_card' %}
    {% set view_mode_name = 'high-school' %}
  {% else %}
    {% set view_mode_name = 'vocational-school' %}
  {% endif %}

  {%
    set classes = [
    'unit',
    'unit--' ~ view_mode_name ~ '-card'
  ]
  %}

  {% set image_attributes = create_attribute() %}

  {% if content.picture_url_override|render or content.picture_url|render %}
    {% set has_image = TRUE %}
  {% endif %}

  {%
    set picture_classes = [
    'unit__image',
    has_image ? 'unit__image--image' : 'unit__image--placeholder'
  ]
  %}

  <div{{ attributes.addClass(classes) }}>
  {% if view_mode == 'high_school_card' and high_school_front_page_nid is not empty %}
    <a href="{{ url('entity.node.canonical', { 'node': high_school_front_page_nid }) }}" class="unit__link">
  {% elseif view_mode == 'high_school_card' and content.www is not empty %}
    <a href="{{ content.www.0 }}" class="unit__link">
  {% else %}
    <a href="{{ url('entity.tpr_unit.canonical', { 'tpr_unit': entity.id() }) }}" class="unit__link">
  {% endif %}
      <div{{ image_attributes.addClass(picture_classes) }}>
        {% if content.picture_url_override|render %}
          {{ content.picture_url_override }}
        {% elseif content.picture_url|render %}
          {{ content.picture_url }}
        {% else %}
          {% include "@hdbt/misc/image-placeholder.twig" ignore missing %}
        {% endif %}
      </div>
      <div class="unit__text">
        <div class="unit__text__content">
          <h3 class="unit__title">
            {% if high_school_front_page_title is not empty %}
              {{ high_school_front_page_title }}
            {% else %}
              {{ entity.label }}
            {% endif %}
          </h3>
          {% if content.address|render %}
            <div class="unit__info-row unit__info-row--address">
              {{ content.address }}
            </div>
          {% endif %}
          {% if content.description_summary|render %}
            <div class="unit__short-desc">
              {{ content.description_summary }}
            </div>
          {% endif %}
          <span class="unit__arrow">
          {% include '@hdbt/misc/icon.twig' ignore missing with {icon: 'arrow-right'} %}
        </span>
        </div>
      </div>
    </a>
  </div>

{% else %}

  {% embed '@helfi_tpr/tpr-unit.html.twig' with {in_menu: in_menu} %}
    {% block sidebar_block %}
      {{ drupal_entity('block', block_name, check_access=false) }}
    {% endblock sidebar_block %}

    {% block main_content %}
      <div class="enriched-content has-sidebar components components--unit">
        {{ content.field_content }}
      </div>
    {% endblock main_content %}

    {% block accessibility_sentences_block %}
      {% if content.accessibility_sentences|render %}

        {% embed "@hdbt/misc/component.twig" with
          {
            component_classes: [
            'component--accordion',
            'component--accordion-bg-grey',
            'component--hardcoded',
            'component--tpr-unit',
          ],
            component_content_class: 'accordion',
          }
        %}
          {% block component_content %}

            {% set accordion_content %}

              {% embed "@hdbt/misc/component.twig" with { component_classes: [ 'component--paragraph-text' ] } %}
                {% block component_content %}
                  {{ content.accessibility_sentences }}
                {% endblock component_content %}
              {% endembed %}

            {% endset %}

            {% include '@hdbt/component/accordion.twig' ignore missing with {
              heading_level: 'h2',
              heading_icon: 'person-wheelchair',
              heading: 'Accessibility information'|t,
              content: accordion_content,
            } %}

          {% endblock component_content %}
        {% endembed %}

      {% endif %}
    {% endblock accessibility_sentences_block %}
  {% endembed %}

{% endif %}
